---
title: "DSjobtracker: What are the qualifications and skills that a data scientist, statistician, or data analyst must possess?"
output: 
  flexdashboard::flex_dashboard:
    orientation: column
    vertical_layout: fill
---


```{r setup, include=FALSE}
library(flexdashboard)
library(wordcloud)
library(wordcloud2)
library(tm)
library(RColorBrewer)
library(stringr)
library(tidyverse)
library(plotly)
library(data.table)
library(countrycode)
library(quantmod)
library(formattable)
library(ggwordcloud)
library(dplyr)
library(ggplot2) 
library(readr)
library(readxl)
library(sp)
library(gganimate)
library(ggpubr)
DStidy_2022 <- read_csv("DStidy_2022.csv")
```

Overview
======================================================
Column
-----------------------------------------------------------------------

### *Job Title*
```{r}

jbs <- str_to_lower(DStidy_2022$Job_title)
jbs <- gsub("[[:punct:]]"," ",jbs)

docs1 <- Corpus(VectorSource(jbs))
docs1 <-docs1 %>% 
  tm_map(removePunctuation) %>%  
  tm_map(removeWords,c("and", "â€“"))

dtm1 <-  TermDocumentMatrix(docs1)
matrix1 <- as.matrix(dtm1)
words1 <- sort(rowSums(matrix1),
               decreasing = TRUE)

jbstitle <- data.frame(word1= names(words1),
                       freq1 =words1)

set.seed(500)

wordcloud(words = jbstitle$word1,
          freq = jbstitle$freq1,  
          min.freq = 2,
          max.words=12,
          random.order=FALSE,
          font=4,
          family= "serif",
          root.per=1.5,
          scale = c(5,1.5),
          colors = brewer.pal(8,"Dark2"))

```

### *Education Qualification* 
```{r}

edu <- str_to_lower(DStidy_2022$Educational_qualifications)
edu <- gsub("[[:punct:]]"," ",edu)

edu <- edu %>% str_replace_all(c(
  "bachelor's" ="bsc",
  "bachelors" = "bsc",
  "bachelor" = "bsc",
  " bachelor" = "bsc",
  "bsc's" ="bsc",
  "master" = "msc",
  "masters"="msc",
  "masterss"="msc",
  "mscs"="msc"))

docs2 <- Corpus(VectorSource(edu))

docs2 <- tm_map(docs2,
                removeWords,
                c("any","etc","with","higher","and","other",
                  "such","related","data","field","of"))

dtm2 <-  TermDocumentMatrix(docs2)
matrix2 <- as.matrix(dtm2)
words2 <- sort(rowSums(matrix2),
               decreasing = TRUE)

eduQua <- data.frame(word2= names(words2),
                     freq2 =words2)

set.seed(2017)

wordcloud(words = eduQua$word2,
          freq = eduQua$freq2,  
          min.freq = 2,
          max.words=12, 
          random.order=FALSE,
          font=4,
          family= "serif",
          root.per=1.5,
          scale = c(4,1),
          colors = brewer.pal(8,"Dark2"))

```


Column
-----------------------------------------------------------------------

### *Job Category* 
```{r}

knw <- DStidy_2022$Job_Category

docs3 <- Corpus(VectorSource(knw))
docs3 <- docs3 %>% 
  tm_map(removePunctuation)
docs3 <- tm_map(docs3,
                removeWords,
                c("with"," knowledge","and","from","for",
                  "the","large"," etl ","using","that",
                  "our","strong","including","methods"))

dtm3 <-  TermDocumentMatrix(docs3)
matrix3 <- as.matrix(dtm3)
words3 <- sort(rowSums(matrix3),
               decreasing = TRUE)

knwBase <- data.frame(word3=names(words3),
                      freq3=words3)

wordcloud(words = knwBase$word3,
          freq = knwBase$freq3, 
          min.freq = 2,
          max.words=12, 
          random.order=FALSE,
          font=4,
          family= "serif",
          root.per=1.5,
          scale = c(5,1.5),
          colors = brewer.pal(8,"Dark2"))

```

### *Company Location* 
```{r}

# Data Cleaning 
DStidy_2022$Country[DStidy_2022$Country == "110 Healthy Way, Folosm, CA"] <- "US"
DStidy_2022$Country[DStidy_2022$Country == "United Kingdom"] <- "UK"
DStidy_2022$Country[DStidy_2022$Country == "Sri Lnaka"] <- "Sri Lanka"
DStidy_2022$Country[DStidy_2022$Country == "SL"] <- "Sri Lanka"
DStidy_2022$Country[DStidy_2022$Country == "Bloomington, IN"  ] <- "US"
DStidy_2022$Country[DStidy_2022$Country == "Edinburgh,London,Manchester"] <- "UK"
DStidy_2022$Country[DStidy_2022$Country == "Nodia,Uttar Pradesh,India"] <- "India"
DStidy_2022$Country[DStidy_2022$Country == "Melbone" ] <-  "Australia"
DStidy_2022$Country[DStidy_2022$Country == "canada"] <- "Canada "
DStidy_2022$Country[DStidy_2022$Country == "Pennsylvania" ] <- "US"  
DStidy_2022$Country[DStidy_2022$Country == "united states"] <-  "US" 
DStidy_2022$Country[DStidy_2022$Country ==  "Sri lanka" ] <- "Sri Lanka"
DStidy_2022$Country[DStidy_2022$Country == "NewYork"] <- "US"
DStidy_2022$Country[DStidy_2022$Country ==  "Sri lanka" ] <- "Sri Lanka"
DStidy_2022$Country[DStidy_2022$Country == "santa monica,CA" ] <- "US"
DStidy_2022$Country[DStidy_2022$Country ==  "Anaheim, CA"] <- "US"
DStidy_2022$Country[DStidy_2022$Country ==  "Bengaluru, Karnataka, India"] <- "India"
DStidy_2022$Country[DStidy_2022$Country == "United States"  ] <- "US"
DStidy_2022$Country[DStidy_2022$Country ==  "Noida,Uttar Pradesh, India" ] <- "India"
DStidy_2022$Country[DStidy_2022$Country == "Remote Work" ] <- "US"
DStidy_2022$Country[DStidy_2022$Country ==  "USA" ] <- "US"
DStidy_2022$Country[DStidy_2022$Country ==  "Canada " ] <- "Canada"

DStidy_2022$Country[DStidy_2022$Country %>% is.na()] <- "US"

coun <- str_to_upper(DStidy_2022$Country)
coun<- gsub(" ","_",coun)

docs4 <- Corpus(VectorSource(coun))
docs4 <- tm_map(docs4,stripWhitespace)
docs4 <- tm_map(docs4,content_transformer(str_to_title))
dtm4 <-  TermDocumentMatrix(docs4)

matrix4 <- as.matrix(dtm4)
words4 <- sort(rowSums(matrix4),
               decreasing = TRUE)

loc <- data.frame(word4 = names(words4),freq4 =words4)

set.seed(2017)

wordcloud(words = loc$word4,
          freq = loc$freq4, 
          min.freq = 2,
          max.words=12, 
          random.order=FALSE,
          font=4,
          family= "serif",
          root.per=1.5,
          scale = c(6,1.5),
          colors = brewer.pal(8,"Dark2"))

```


Spatial Distributions
======================================================

```{r  include=FALSE}

library(flexdashboard)
library(tidyverse)
library(plotly)
library(data.table)
library(countrycode)
library(quantmod)
library(formattable)


#--------------------------------------------------#JOB TYPE

df <- read_csv("DStidy_2022.csv")

df <- df %>% separate(Job_title, into = c("word1", "word2",
                                                    "word3", "word4"), 
                                sep = " ") %>%
                       unite("Job.Type", c("word1", "word2",
                                           "word3", "word4"))

# Categorizing job titles

# data scientist
df$Job.Type <-  gsub(".*_Data_Scien.*", "Data Scientist", 
                          df$Job.Type)
df$Job.Type <-  gsub("^\\Data_Sci.*", "Data Scientist", 
                          df$Job.Type)
df$Job.Type <-  gsub("^\\Data_sci.*", "Data Scientist", 
                          df$Job.Type)
df$Job.Type <-  gsub(".*_Scient.*", "Data Scientist", 
                          df$Job.Type)
df$Job.Type <-  gsub(".*_Python_Developer.*", "Data Scientist", 
                          df$Job.Type)
df$Job.Type <-  gsub("Software_Development_NA_NA", "Data Scientist", 
                          df$Job.Type)


# data analyst
df$Job.Type <-  gsub("^\\Analy.*", "Data Analyst", 
                          df$Job.Type)
df$Job.Type <-  gsub(".*_Analy.*", "Data Analyst", 
                          df$Job.Type)
df$Job.Type <-  gsub(".*_Data.*", "Data Analyst", 
                          df$Job.Type)
df$Job.Type <-  gsub("^\\Data_Co.*", "Data Analyst", 
                          df$Job.Type)

# data engineer
df$Job.Type <-  gsub(".*_Engineer.*", "Data Engineer", 
                          df$Job.Type)
df$Job.Type <-  gsub("Data_Lackhouse_Specialist/_BI", "Data Engineer", 
                          df$Job.Type)
df$Job.Type <-  gsub("Database_Administrator_NA_NA", "Data Engineer", 
                          df$Job.Type)
df$Job.Type <-  gsub("Data_Lackhouse_Specialist/_BI", "Data Engineer", 
                          df$Job.Type)
df$Job.Type <-  gsub(".*Machine_Learning.*", "Data Engineer", 
                          df$Job.Type)


# statistician
df$Job.Type <-  gsub(".*Stat.*", "Statistician", 
                          df$Job.Type)
df$Job.Type <-  gsub("^\\Rese.*", "Statistician", 
                          df$Job.Type)
df$Job.Type <-  gsub("Bank_Compliance_Fair_Banking/Lending", "Statistician", 
                          df$Job.Type)
df$Job.Type <-  gsub("Biostatistician_NA_NA_NA", "Statistician", 
                          df$Job.Type)
df$Job.Type <-  gsub("Computational_Biologist_NA_NA", "Statistician", 
                          df$Job.Type)


# Other
df$Job.Type <-  gsub("Business_Associate_-_Planning", "Other", 
                          df$Job.Type)
df$Job.Type <-  gsub("^\\C.*", "Other", 
                          df$Job.Type)
df$Job.Type <-  gsub("D_&_A_Azure", "Other", 
                          df$Job.Type)
df$Job.Type <-  gsub("^\\IT.*", "Other", 
                          df$Job.Type)
df$Job.Type <-  gsub("Product_Manager_NA_NA", "Other", 
                          df$Job.Type)
df$Job.Type <-  gsub("^\\Tech.*", "Other", 
                          df$Job.Type)


```

column {data-width=400}
-------------------------------------

### Spatial Distribution of proportion of Job Advertisments
    
```{r Job advertisments map}

new <- df %>%
  select(c(Country, country_code)) %>%
  group_by(country_code) %>%
  count(Country) %>%
  ungroup() %>%
  mutate(Percentage = percent(n/sum(n)))

# Extracting countries with more than 9 job advertisements
new <- new %>% filter(Country %in% c("United States", "Sri Lanka", "Australia",
                                     "United Kingdom", "Singapore", "Canada",
                                     "India", "United Arab Emirates",
                                     "Germany", "Qatar"))

fig1 <- plot_ly(new, type='choropleth', locations=new$country_code, z=new$Percentage, text=~paste('Country: ', 
                                                                                                 new$Country, '<br> Count: ', new$n, '<br> Percentage: ',new$Percentage),hoverinfo = 'text',colorscale="Viridis") %>%
        layout(title = "Spatial Distribution of Proportion of Job Advertisments")

fig1


```

### Advertisment Distribution by country

```{r}

fig2 <- new %>%
  plot_ly(
  x = ~n,
  y = ~reorder(Country,-desc(n)),
  type = "bar",
  orientation = "h"
  ) %>%
  layout(title = "Distribution of Job Advertisments by Country",
         yaxis = list(title = " "), xaxis = list(title = "Total Number of Advertisments",categoryorder = "n"), barmode = 'stack')

fig2
  
```

Row {}
-------------------------------------

### Distribution by Job Type

```{r}
new.data <- df %>%
  select(c(Country, country_code, Job.Type)) %>%
  filter(Country %in% c("United States", "Sri Lanka", "Australia",
                                     "United Kingdom", "Singapore", "Canada")) %>%
  group_by(Job.Type, Country) %>% count(Job.Type) %>%
  filter(Job.Type %in% c("Data Analyst", "Data Scientist", "Data Engineer", 
                         "Statistician"))

new.data$Job.Type <- factor(new.data$Job.Type, levels = c("Data Analyst", "Data Scientist", "Data Engineer", "Statistician"))

fig3 <- new.data %>% plot_ly(x = ~Country, y = ~n, type = 'bar',
                             color = ~Job.Type, colors = "Dark2") %>%
        layout(title = "Distribution of Job Types by Top Six Countries",
         yaxis = list(title = "Total Count"), xaxis = list(title = "Country"))


fig3
```

Job Fields
======================================================

Column
--------------------------------------------------------------

### Composition of Job Fields

```{r}
library(dplyr)
df <- read_csv("DStidy_2022.csv")

# Function to categorize data science job fields
categorize_data_science_job <- function(job_field) {
  if (grepl("IT|Software|Developer|Engineer", job_field, ignore.case = TRUE)) {
    return("Information technology")
  } else if (grepl("Consultant|Manager|Analyst|Advisor", job_field, ignore.case = TRUE)) {
    return("Professional services")
  } else if (grepl("Telecom|Communication|Network", job_field, ignore.case = TRUE)) {
    return("Telecommunication")
  } else if (grepl("Manufacturing|Analytics|Specialist", job_field, ignore.case = TRUE)) {
    return("Manufacturing")
  } else if (grepl("Finance|Financial|Quantitative|Banking", job_field, ignore.case = TRUE)) {
    return("Finance")
  } else if (grepl("Health|Medical|Healthcare|Hospitals", job_field, ignore.case = TRUE)) {
    return("Health")
  } else if (grepl("E-commerce|Online Retail", job_field, ignore.case = TRUE)) {
    return("E commerce")
  } else if (grepl("Insurance|Actuary", job_field, ignore.case = TRUE)) {
    return("Insurance")
  } else if (grepl("Teacher|Education|Instructor|Lecturer", job_field, ignore.case = TRUE)) {
    return("Education")
  } else if (grepl("Agriculture|Farm|Agricultural", job_field, ignore.case = TRUE)) {
    return("Agriculture")
  } else {
    return("Other")
  }
}

# Apply categorization function to each data science job field
df$`Job Field `<- sapply(df$Job_Field, categorize_data_science_job)

view(df)

```


```{r}

jf_counts <- df %>%
  count(`Job Field `) %>% 
  mutate(`Job Field ` = fct_reorder(factor(`Job Field `),n)) 

l <- levels(jf_counts$`Job Field `)

jf_counts %>% 
  mutate(`Job Field ` = fct_relevel(`Job Field `,c("Other",l[l != "Other"]))) %>% 
  ggplot(aes(x = `Job Field `,y = n))+
  geom_bar(stat="identity")+
  coord_flip()
```



Column {.tabset .tabset-fade}
--------------------------------------------------------------

### R and Python Requirements of Job Fields

```{r}
df <- df %>%
  mutate(R = as.numeric(R), Python = as.numeric(Python)) # Convert columns to numeric


```

```{r}


df.1 <- df %>%
  filter(!is.na(`Job Field `))   # Remove rows with missing values in 'Job Field' column

df.1 <- df %>%
  group_by(`Job Field `) %>%
  summarize(
    Total = sum(R, na.rm = TRUE) + sum(Python, na.rm = TRUE),
    R = sum(R, na.rm = TRUE) * 100 / Total,
    Python = sum(Python, na.rm = TRUE) * 100 / Total
  ) %>%
  ungroup()

# Make sure levels are unique before reordering
df.1$`Job Field ` <- fct_inorder(df.1$`Job Field `)

df.1 <- df.1 %>%
  mutate(`Job Field ` = fct_reorder(`Job Field `, R))


df.1 %>%  pivot_longer(cols = c("R", "Python"), names_to = "Language", values_to = "Counts") %>%
 mutate(`Job Field ` = fct_relevel(`Job Field `,c("Other",l[l != "Other"]))) %>%  
  ggplot(aes(x = `Job Field `, y = Counts, fill = Language)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  theme(legend.position = "bottom") +
  scale_fill_manual(values = c("#306998", "#919198")) +
  labs(x = "Job Field", y = "Percentage Proportion within Job Field")
```


### Tableau and Microsoft Power BI Requirements of Job Fields

```{r}
df <- df %>%
  mutate(Tableau = as.numeric(Tableau), `Microsoft Power BI` = as.numeric(`Microsoft Power BI`)) # Convert columns to numeric


```

```{r}

df.2 <- df %>%
  filter(!is.na(`Job Field `))   # Remove rows with missing values in 'Job Field' column


df.2 <- df.2 %>% 
  group_by(`Job Field `) %>% 
  summarize(Total = sum(Tableau) + sum(`Microsoft Power BI`),
            Tableau= sum(Tableau)*100/Total,`Microsoft Power BI` = sum(`Microsoft Power BI`)*100/Total) %>%
  ungroup() 

# Make sure levels are unique before reordering
df.2$`Job Field ` <- fct_inorder(df.2$`Job Field `)

df.2 <- df.2 %>%
  mutate(`Job Field ` = fct_reorder(`Job Field `, Tableau))


df.2 %>%  pivot_longer(cols= c("Tableau","Microsoft Power BI"), names_to = "Language",values_to = "Counts") %>%
 mutate(`Job Field ` = fct_relevel(`Job Field `,c("Other",l[l != "Other"]))) %>%  
  ggplot(aes(x = `Job Field `, y = Counts, fill = Language)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  theme(legend.position = "bottom") +
  scale_fill_manual(values = c("#ffba01","#c7233b")) +
  labs(x = "Job Field", y = "Percentage Proportion within Job Field")

```

### Minimum experience needed in Job Fields


```{r}

# Filter out rows with NA in 'Min Exp' and making it numerical
df <- df[!is.na(df$`Minimum Experience in Years`), ]
df$`Minimum Experience in Years` <- as.numeric(df$`Minimum Experience in Years`)
```

```{r}
# Create a horizontal grouped box plot
df %>% 
  ggplot(aes(x = `Job Field `, y = `Minimum Experience in Years`))+
  geom_boxplot()+
  coord_flip()
  
```


English Requirement
======================================================


```{r, message=FALSE, include=FALSE}
## change column name 
colnames(DStidy_2022)[colnames(DStidy_2022) == "English Needed"] = "English Requirement"

## checking if there are any NA values 
unique(DStidy_2022$`English Requirement`)
class(DStidy_2022$`English Requirement`)

# replace NA with 0 
DStidy_2022["English Requirement"][is.na(DStidy_2022["English Requirement"])] <- 0
unique(DStidy_2022$`English Requirement`)

## Location 
unique(DStidy_2022$`Country`)

## Replace NA with other in Location column 
DStidy_2022["Country"][is.na(DStidy_2022["Country"])] <- "Other"
unique(DStidy_2022$`Country`)

## detecting continents
DStidy_2022$Continent = ifelse(DStidy_2022$Country %in% c("Sri Lanka", "Singapore", "United Arab Emirates", 
          "Japan", "India", "Malaysia","Thailand", "Turkey", "China", "Qatar"), "Asia", 
  ifelse(DStidy_2022$Country %in% c("UK", "Denmark", "Hungary", "Germany", "Greece", 
  "Lithuania", "Sweden", "Poland", "Spain", "Belgium", "Netherlands", "Finland", "Romania", "Italy", 
  "Czech Republic", "Switzerland", "Russia", "Malta", "Portugal", "Bulgaria"), "Europe", 
  ifelse(DStidy_2022$Country %in% c("Tunisia"), "Africa", 
  ifelse(DStidy_2022$Country %in% c("New Zealand", "Australia"), "Oceania", 
  ifelse(DStidy_2022$Country %in% c("USA", "Mexico", "Virginia", "Canada"), "North America",
ifelse(DStidy_2022$Country %in% c("Ecuador"), "South America", "Unknown"))))))

unique(DStidy_2022$Continent)

## Job category 
unique(DStidy_2022$Job_Category)
unique(DStidy_2022$Job_title)

## Making job fields unique
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category %in% c("Computer/Information Technology", "IT", "Information Services"),
                            "Information Technology", DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Software Developmwnt", "Software Development", 
                                  DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Data science" , "Data Science", 
                                  DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Analyst, Engineering and Information Technology",
                            "Analyst, Engineering, Information Technology", DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Management, Engineering and Analyst" ,
                            "Management, Engineering, Analyst", DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Information Technology and Analyst" ,
                            "Information Technology, Analyst", DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Research, Analyst, and Information Technology" ,
                            "Research, Analyst, Information Technology", DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Consulting, Information Technology, and Sales",
                            "Consulting, Information Technology, Sales", DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Finance and Sales",
                            "Finance, Sales" , DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Research, Consulting, and Analyst",
                            "Research, Consulting, Analyst", DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Information Technology, Analyst, and Science",
                            "Information Technology, Analyst, Science", DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Engineering - Software" ,
                            "Software Development" , DStidy_2022$Job_Category)
DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Engineering and Information Technology" ,
                            "Engineering, Information Technology" , DStidy_2022$Job_Category)

unique(DStidy_2022$Job_Category)

## spelling error 
DStidy_2022 = DStidy_2022 %>%               
  separate_rows(Job_Category, sep=", ")

DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category == "Data Analytics" ,
                            "Data Analyst" , DStidy_2022$Job_Category)


## English Requirement 

DStidy_2022$Job_Category = ifelse(DStidy_2022$Job_Category %in%
                              c("Data Science", "Information Technology", "Data Analyst",
                                "Analyst", "Research", "Machine Learning", "AI", "Engineering", "Consulting"), DStidy_2022$Job_Category, "Other")

DStidy_2022$`English Requirement`= ifelse(DStidy_2022$`English Requirement` == 1, "Required", "Not Specified")
unique(DStidy_2022$Job_Category)
```


## Column {data-width=500}
--------------------------------------------------------------

### English Requirement by Continent

```{r, message=FALSE, warning=FALSE}
options(dplyr.summarise.inform = FALSE)
df_english_req_cont = select(DStidy_2022, c("Continent", "English Requirement"))

df_english_req_cont = df_english_req_cont %>%
  group_by(Continent, `English Requirement`) %>%
  summarise(cnt = n())

df_english_req_cont = df_english_req_cont %>% mutate(perc = round(cnt / sum(cnt), 2)*100) 

## unique(df_english_req_cont$Continent)
df_english_req_cont_temp <- df_english_req_cont
  
df_english_req_cont_temp$Continent <- factor(df_english_req_cont$Continent, levels = c("Unknown", "South America", "Africa", "Oceania", "Asia", "North America", "Europe")) 

ggplot(df_english_req_cont_temp, aes(fill=`English Requirement`, y=Continent, x=perc, label = cnt)) +
  geom_bar( stat="identity") +
  geom_text(size = 3, position = position_stack(vjust = 0.5)) +
  labs(y = "Continent", x = "Percentage") +
  theme(legend.position = "bottom") + 
  scale_fill_manual(values = c("#919198", "deeppink3")) + 
  guides(fill = guide_legend(reverse = TRUE))
```

## Column {data-width=500}
--------------------------------------------------------------

### English Requirement by Job Category

```{r, message=FALSE, warning=FALSE}
## plot2 
options(dplyr.summarise.inform = FALSE)
data_english_req_job = select(DStidy_2022, c("Job_Category", "English Requirement"))
data_english_req_job = DStidy_2022 %>%
  group_by(Job_Category, `English Requirement`) %>%
  summarise(cnt = n())
## unique(data_english_req_job$Job_Category)

data_english_req_job = data_english_req_job %>% mutate(perc = round(cnt / sum(cnt), 2)*100)

data_english_req_job_temp <- data_english_req_job
data_english_req_job_temp$Job_Category <- factor(data_english_req_job_temp$Job_Category, levels = c("Other", "Machine Learning", "Engineering", "Consulting", "Information Technology", "Analyst", "Research", "Data Science", "AI", "Data Analyst")) 

### English Requirement by Job Field
ggplot(data_english_req_job_temp, aes(fill=`English Requirement`, y=Job_Category, x=perc, label = cnt)) +
  geom_bar(stat="identity") +
  geom_text(size = 3, position = position_stack(vjust = 0.5)) +
  labs(y= "Job Category", x = "Percentage") +
  theme(legend.position = "bottom") +
  scale_fill_manual(values = c("#919198", "deeppink3")) + 
  guides(fill = guide_legend(reverse = TRUE))
```


Education
======================================================

```{r , include=FALSE}
library(flexdashboard)
library(plotly)
library(dplyr)
```

```{r data}
edu <- DStidy_2022 %>% select("BSc_needed","MSc_needed","PhD_needed")
# convert data set into numeric
edu1 <- as.data.frame(apply(edu, 2, as.numeric))
education <- replace(edu1, is.na(edu1), 1)
d <- education %>%
  rowwise() %>%
  mutate(degree = sum(BSc_needed,MSc_needed,PhD_needed, na.rm = T))

# Education qualification is classified based on the minimum level of education.
for(i in 1:nrow(d)){
 if((d[i,1] == 1 & d[i,4]>=1) == TRUE){  # BSc
    d$V3[i] <- "Bachelor's"
  }else if((d[i,1]== 0 & d[i,2] == 1 & d[i,4]>=1) == TRUE){  # MSc
    d$V3[i] <- "Master's"
  }else if ((d[i,3] == 1 & d[i,4]==1) == TRUE){ # PhD
    d$V3[i] <- "PhD"   
  }else if (( d[i,4]==0 ) == TRUE){  
    d$V3[i] <- "Other"
 
  }}  # other - There is no mention of a degree level, so there could be a different educational qualification. qualification 

d <- d %>% rename(degree_level = V3)
d <- d %>% select(-`degree`)
Final_edu <- d %>% group_by(degree_level) %>% 
  summarise(total_count=n(),
            .groups = 'drop')
Final_edu$degree_level <- factor(Final_edu$degree_level, levels = c("Other","PhD","Master's","Bachelor's"))
``` 


Column {data-width=200}
-----------------------------------------------------------------------

### Educational Qualifications

```{r}
plot1 <- Final_edu %>% plot_ly(x = ~total_count, y = ~degree_level, type = 'bar',
                               marker = list(color = '#CA3C97')) %>%
  layout(
    title= "Education Qualification",
    xaxis = list(title = "Number of Job Vacancies",tickangle=-45 ,c("Other","Diploma","Bachelor's","Master's","PhD")) ,
    yaxis = list(title = " Minimum Education Qualification"),font = list(color = 'black'))
plot1

```


Experience
======================================================

```{r}
## Packages
library(tidyverse)
library(plotly)
library(DSjobtracker)
```


```{r}
## Install the data set
DStidy_2022 <- read_csv("DStidy_2022.csv")
DStidy_2022 <- DStidy_2022 %>% mutate(`Minimum Experience in Years` = case_when(
 `Minimum Experience in Years` %in% c(0.5,1) ~ 1,
 `Minimum Experience in Years`== 0 ~ 0 ,
  `Minimum Experience in Years`== 2 ~ 2,
  `Minimum Experience in Years`== 3 ~ 3,
  `Minimum Experience in Years`== 4 ~ 4,
  `Minimum Experience in Years`== 5 ~ 5,
  `Minimum Experience in Years`== 6 ~ 6,
  `Minimum Experience in Years`== 7 ~ 7,
  `Minimum Experience in Years`== 8 ~ 8,
  `Minimum Experience in Years`== 10 ~ 10,
  `Minimum Experience in Years`== 12 ~ 12
))
  

```

column{}
----------------------------------------------------------------------

### Distribution of Minimun Years of Experience

```{r}
plot_ly(DStidy_2022,
        x = ~`Minimum Experience in Years`,
        type = "histogram") %>%
  layout(xaxis = list(title = "Minimum Required Experience in Years"),
         yaxis = list(title = "No of Job Advertisements"), 
         showlegend = FALSE)
```


column{.tabset}
-----------------------------------------------------------------------

### Distribution of Experience by Job Category

```{r}
DStidy_2022 <- DStidy_2022 %>% mutate(`Job_Category` = case_when(
   `Job_Category` %in% c("Business Analytics","Business/Systems Analysts","Finance and Sales","Business Development and Sales","Administrative","Human Resources Services", "Consulting, Information Technology, and Sales","Information Services","IT Services") ~ "Business Analyst",
  
   `Job_Category` %in% c("Data Science","Database Systems","Statistics","Data science","Research, Consulting, and Analyst","Actuarial Science","Information Technology, Analyst,and Science","Machine Learning","AI", "Artificial Intelligence") ~ "Data Scientist",
 
    `Job_Category` %in% c("Data Analyst","Science & Technology","Sciences","Internet Publishing" ,"Science and Analyst","Analyst","Research, Consulting, and Analyst","Research, Analyst, and Information Technology") ~ "Data Analyst",
 
    `Job_Category` %in% c( "Engineering - Software","Engineering, Mechanical" ,"Data Engineering","Software Developmwnt","Information Technology", "Computer/Information Technology","IT","Analyst, Engineering and Information Technology","Management, Engineering and Analyst","Engineering and Information  Technology","Information Technology and Analyst")~"Data Engineering"
 

))
data_exp <- DStidy_2022 %>% filter(Job_Category != "NA")

plot_ly(data_exp,
        x = ~Job_Category,
        y = ~`Minimum Experience in Years`,
        type = "box",
        color = ~Job_Category,
        colors = c("#1b9e77", "#d95f02", "#7570b3", "#e7298a","blue")) %>%
  layout(xaxis = list(title  = "Job Category", tickangle = 0),
         yaxis = list(title = "Minimum Required Experience in Years"), showlegend = FALSE)
```

### Distribution of Experience by Educational Qualifications


```{r}

edu <- DStidy_2022 %>% select("BSc_needed","MSc_needed","PhD_needed","Minimum Experience in Years")

# convert data set into numeric
edu1 <- as.data.frame(apply(edu, 2, as.numeric))

education <- replace(edu1, is.na(edu1), 1)


data_new <- pivot_longer(education, c(1:3), names_to = "Education", values_to = "Value")



data2 <- data_new %>% filter(Value == 1)


plot_ly(data2,
        x = ~ Education,
        y = ~`Minimum Experience in Years`,
        type = "box",
        color = ~Education,
        colors = c("#e41a1c", "#377eb8", "#4daf4a")) %>%
  layout(xaxis = list(title  = "Minimum Educational Qualifications", tickangle = 0),
         yaxis = list(title = "Minimum Required Experience in Years"), showlegend = FALSE)

```




Top Software and Skills
======================================================

Column {data-width=500}
-----------------------------------------------------------------------

### Top 20 skills required in jobs

```{r }

Top_skills_required<- DStidy_2022%>%
  select(c(AI:Web_Analytic_tools)) %>%
  pivot_longer(c(AI:Web_Analytic_tools), values_to = "Value", names_to = "Name") %>%
  group_by(Name) %>%
  summarize(Total = sum(Value, na.rm = TRUE)) %>% 
  arrange(Total) 
  
  Top_skills_required %>%
  mutate(Name = factor(Name, levels = .$Name)) %>%
  top_n(20) %>%
plot_ly(
        x= ~Total,
        y= ~reorder(Name,Total),
        type = "bar",
   marker = list(color = "hsl(0,100%,50%))") ,height = 800,width = 700)  %>% 
 
layout(title = "Top 20 Skills Required in Jobs",xaxis = list(title = "No of Job Advertisments"),
         yaxis =list(title = "Skills Required"))
```



Column {data-width=500}
-----------------------------------------------------------------------

### Soft skills required in jobs

```{r}

 Soft_skills_required<- DStidy_2022%>%
  select(c(Presentation_Skills:`agile execution`)) %>%
  pivot_longer(c(Presentation_Skills:`agile execution`), values_to = "Value", names_to = "Name") %>%
  group_by(Name) %>%
  summarize(Total = sum(Value, na.rm = TRUE)) %>% 
  arrange(Total) 

Soft_skills_required %>%
  plot_ly(labels = ~Name,
          values = ~Total,
          parents = NA,
          type = "treemap", height = 600, width = 650, textinfo = "label+value+percent parent") %>%
  layout(title = "Soft Skills Required in Jobs")

```


Software Skills
======================================================

Column {data-width=500}
-----------------------------------------------------------------------

### Statistical softwares

```{r}

Statistical_software <- paste(DStidy_2022$R,DStidy_2022$SAS,DStidy_2022$SPSS,DStidy_2022$Python,sep = "::")


d1 <- Statistical_software %>% table() %>% as.data.frame()
names(d1) <- c('Statistical_software', 'Frequency')
d1 <- d1[order(d1$Frequency, decreasing = T),]

Statistical_software[Statistical_software=="1::0::0::0"] <-"R only"
Statistical_software[Statistical_software=="0::0::0::1"] <-"Python only"
Statistical_software[Statistical_software=="0::1::0::0"] <-"SAS only"
Statistical_software[Statistical_software=="1::0::0::1"] <-"R & Python"
Statistical_software[Statistical_software=="1::1::0::1"] <-"R, SAS & Python only "
Statistical_software[Statistical_software=="0::0::0::0"] <-"No statistical softwares"
Statistical_software[Statistical_software=="0::1::0::1"|
                     Statistical_software=="1::1::1::1"|
                     Statistical_software=="0::1::1::1"|
                     Statistical_software=="1::1::1::0"|
                     Statistical_software=="0::0::1::0"|
                     Statistical_software=="1::0::1::0"|
                     Statistical_software=="1::0::1::1"|
                     Statistical_software=="0::1::1::0"|
                     Statistical_software=="0::1::0::NA"|
                     Statistical_software=="0::0::1::1"|
                     Statistical_software=="1::1::0::0"] <- "Other statistical softwares"


d1 <- Statistical_software %>% table() %>% as.data.frame()
names(d1) <- c('Statistical_software', 'Frequency')
d1 <- d1[order(d1$Frequency, decreasing = T),]


d1 %>% plot_ly(x = ~Frequency, y = ~reorder(Statistical_software, Frequency), 
               type =  'bar', orientation = 'h') %>% 
  layout(title = "", 
         xaxis = list(title = "Number of job advertisements" ,zeroline = FALSE),
         yaxis = list(title = "", zeroline = FALSE))

```



Column {data-width=500}
-----------------------------------------------------------------------

### Database and Query languages

```{r}
Database_and_Query_languages <- paste(DStidy_2022$SQL,DStidy_2022$NoSQL,DStidy_2022$MySQL,DStidy_2022$Hadoop,sep = "::")


d2 <- Database_and_Query_languages %>% table() %>% as.data.frame()
names(d2) <- c('Database_and_Query_languages', 'Frequency')
d2 <- d2[order(d2$Frequency, decreasing = T),]


Database_and_Query_languages[Database_and_Query_languages=="1::0::0::0"] <-"SQL only"
Database_and_Query_languages[Database_and_Query_languages=="1::0::1::0"] <-"SQL & MySQL"
Database_and_Query_languages[Database_and_Query_languages=="1::0::0::1"] <-"SQL & Hadoop"
Database_and_Query_languages[Database_and_Query_languages=="1::1::0::0"] <-"SQL & NoSQL"
Database_and_Query_languages[Database_and_Query_languages=="0::0::0::0"] <-"No database or query languages"

Database_and_Query_languages[Database_and_Query_languages=="0::0::1::0"|
                             Database_and_Query_languages=="0::1::0::0"| 
                             Database_and_Query_languages=="0::0::0::1"| 
                             Database_and_Query_languages=="1::1::1::1"| 
                             Database_and_Query_languages=="1::1::0::1"| 
                             Database_and_Query_languages=="1::0::1::1"| 
                             Database_and_Query_languages=="0::1::1::1"| 
                             Database_and_Query_languages=="0::0::NA::0"| 
                             Database_and_Query_languages=="1::1::1::0"] <- "Other"


d2 <- Database_and_Query_languages %>% table() %>% as.data.frame()
names(d2) <- c('Database_and_Query_languages', 'Frequency')
d2 <- d2[order(d2$Frequency, decreasing = T),]


d2 %>% plot_ly(x = ~Frequency, y = ~reorder(Database_and_Query_languages, Frequency), 
               type =  'bar', orientation = 'h', color = "red") %>% 
  layout(title = "", 
         xaxis = list(title = "Number of job advertisment" ,zeroline = FALSE), 
         yaxis = list(title = ""))


```



Knowledge and Skills by Job Category
======================================================

```{r, message=FALSE, include=FALSE}

## changing column names 
colnames(DStidy_2022)[colnames(DStidy_2022) == "Natural_Language_Processing(NLP)"] = "Natural Language Processing"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Data_Pipelines"] = "Data Pipelines"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Machine_Learning"] = "Machine Learning"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Computer_vision"] = "Computer Vision"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Data_visualization"] = "Data Visualization"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Data_warehouse"] = "Data Warehouse"
colnames(DStidy_2022)[colnames(DStidy_2022) == "BigData"] = "Big Data"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Data_management"] = "Data Management"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Data_mining"] = "Data Mining"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Data_science"] = "Data Science"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Numerical_Analysis"] = "Numerical Analysis"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Problem_Solving"] = "Problem Solving"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Team_Handling"] = "Team Handling"
colnames(DStidy_2022)[colnames(DStidy_2022) == "agile execution"] = "Agile Execution"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Data_marketing"] = "Data Marketing"
colnames(DStidy_2022)[colnames(DStidy_2022) == "SEO"] = "Search Engine Optimization"
colnames(DStidy_2022)[colnames(DStidy_2022) == "graphics_and_design_skills"] = "Graphic Designing"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Content_Management"] = "Content Management"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Economic"] = "Economic Knowledge"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Finance_Knowledge"] = "Finance Knowledge"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Investment_Knowledge"] = "Investment Knowledge"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Debtor_reconcilation"] = "Debtor Reconcilation"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Presentation_Skills"] = "Presentation Skills"
colnames(DStidy_2022)[colnames(DStidy_2022) == "Payroll_management"] = "Payroll Management"
colnames(DStidy_2022)[colnames(DStidy_2022) == "AI"] = "Artificial Intelligence"
colnames(DStidy_2022)[colnames(DStidy_2022) == "IOT"] = "IOT (Internet of Things)"
```

Column {data-width=650}
-----------------------------------------------------------------------

### Treemap of Knowledge and skills

```{r, message=FALSE, warning=FALSE}
## tree map 

ks<-DStidy_2022 %>% select(c(`Artificial Intelligence`:`IOT (Internet of Things)`,`Presentation Skills`:`Payroll Management`))

df<-ks%>%pivot_longer(1:30)
colnames(df)[1] <- "Knowledge and Skills"
colnames(df)[2] <- "Cases"
df<- df %>%group_by(`Knowledge and Skills`) %>%
  summarize(No_of_Job_vacancies = sum(Cases))%>%mutate(parents="Knowledge and Skills") 

##plot
tree_all <- df%>%plot_ly(type="treemap",labels=~`Knowledge and Skills`,parents=~parents,values=~No_of_Job_vacancies,domain=list(column=0),
             textinfo="label+value+percent parent")
tree_all
```

## Column {.tabset}

### Knowledge

```{r,message=FALSE,warning = FALSE}
## preparing data
Job_Titles <- str_to_lower(DStidy_2022$Job_title)
Job_Titles <- str_trim(Job_Titles)

DS <- Job_Titles[str_detect(Job_Titles, "([data]{4}|machine)[&a-z\\s]*([scientist]{7,10})|\\s+ai")] %>% unique() 
DE <- Job_Titles[str_detect(Job_Titles, "([data]{4}|machine|intelligence)[&a-z\\s]*([engineer]{8,9})")] %>% unique()
DA <- Job_Titles[str_detect(Job_Titles, "anal|statist|actuarial|research|statician")] %>% unique()

DA <- DA %>% append(Job_Titles[!(Job_Titles%in%c(DS,DE,DA))] %>% unique() %>% .[str_detect(.,"data\\s+")]) 
DS <- DS %>% append(Job_Titles[!(Job_Titles%in%c(DS,DE,DA))] %>% unique() %>% .[str_detect(.,"machine\\s+")])

DA <- DA[!DA%in%DS]
DA <- DA[!DA%in%DE]
DS<-DS[!DS%>%is.na()]
DE<-DE[!DE%>%is.na()]
Unimportant <- Job_Titles[!(Job_Titles%in%c(DS,DE,DA))] %>% unique()

DStidy_2022  <- DStidy_2022 %>% mutate(Job_Titles, Job_Category= 
                                         ifelse(Job_Titles%in%DE, "Data Engineering", 
                                                ifelse(Job_Titles%in%DS, "Data Science", ifelse(Job_Titles%in%DA,"Data Analyst", "Other" ) ) )) 

## dot chart 
df1<-DStidy_2022%>%select(c(`Artificial Intelligence`:`IOT (Internet of Things)`,Job_Category))
                          
df11 <- df1 %>% pivot_longer(1:16) 

colnames(df11)[2] <- "Knowledge"
colnames(df11)[3] <- "Cases"

df12 <- df11 %>% filter(Cases == 1) 
df12 <- df12 %>% group_by(Knowledge,Job_Category) %>% count()

p2<- ggdotchart(df12,x = "Knowledge" ,y="n",color = "Job_Category",palette = c("#00AFBB","#E7B800","#FC4E07","#FF1493","#7FFFD4"),sorting = "asc",sort.by.groups=TRUE,add="segments",add.params = list(color="lightgray",size=2),dot.size = 4,ggtheme =theme_pubclean())+ font("x.text",size=8,vjust=0.5)+labs(x="Required Knowledge ",y="Count")

ggpar(p2,legend.title = "")%>%ggplotly()%>%layout(legend=list(orientation="h",xanchor="center",x=0.5,y=1.6))
```

### Other required skills 
```{r,message=FALSE,warning = FALSE}
## preparing data 

df2<-DStidy_2022%>%select(c(`Presentation Skills`:`Payroll Management`,Job_Category))
df21 <- df2 %>% pivot_longer(1:14) 
## changing column name 
colnames(df21)[2] <- "Skills"
colnames(df21)[3] <- "Cases"

df22 <- df21 %>% filter(Cases == 1) 
df22 <- df22 %>% group_by(Skills,Job_Category) %>% count()

## dot chart 
p3<- ggdotchart(df22,x = "Skills" ,y="n",color = "Job_Category",palette = c("#00AFBB","#E7B800","#FC4E07","#FF1493","#7FFFD4"),sorting = "asc",sort.by.groups=TRUE,add="segments",add.params = list(color="lightgray",size=2),dot.size = 4,ggtheme =theme_pubclean())+ font("x.text",size=8,vjust=0.5)+labs(x="Required Skills ",y="Count")

ggpar(p3,legend.title = "")%>%ggplotly()%>%layout(legend=list(orientation="h",xanchor="center",x=0.5,y=1.6))
```





Salary 
=====================================


```{r ann, include=FALSE}
library(flexdashboard)
library(plotly)
library(tidyverse)
library(DT)
library(shiny)

dfs <- read_csv("DStidy_2022.csv")

dfs <- dfs %>% separate(Job_title, into = c("word1", "word2",
                                                    "word3", "word4"), 
                                sep = " ") %>%
                       unite("Job.Type", c("word1", "word2",
                                           "word3", "word4"))

# Categorizing job titles

# data scientist
dfs$Job.Type <-  gsub(".*_Data_Scien.*", "Data Scientist", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("^\\Data_Sci.*", "Data Scientist", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("^\\Data_sci.*", "Data Scientist", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub(".*_Scient.*", "Data Scientist", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub(".*_Python_Developer.*", "Data Scientist", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("Software_Development_NA_NA", "Data Scientist", 
                          dfs$Job.Type)


# data analyst
dfs$Job.Type <-  gsub("^\\Analy.*", "Data Analyst", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub(".*_Analy.*", "Data Analyst", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub(".*_Data.*", "Data Analyst", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("^\\Data_Co.*", "Data Analyst", 
                          dfs$Job.Type)

# data engineer
dfs$Job.Type <-  gsub(".*_Engineer.*", "Data Engineer", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("Data_Lackhouse_Specialist/_BI", "Data Engineer", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("Database_Administrator_NA_NA", "Data Engineer", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("Data_Lackhouse_Specialist/_BI", "Data Engineer", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub(".*Machine_Learning.*", "Data Engineer", 
                          dfs$Job.Type)


# statistician
dfs$Job.Type <-  gsub(".*Stat.*", "Statistician", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("^\\Rese.*", "Statistician", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("Bank_Compliance_Fair_Banking/Lending", "Statistician", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("Biostatistician_NA_NA_NA", "Statistician", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("Computational_Biologist_NA_NA", "Statistician", 
                          dfs$Job.Type)


# Other
dfs$Job.Type <-  gsub("Business_Associate_-_Planning", "Other", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("^\\C.*", "Other", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("D_&_A_Azure", "Other", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("^\\IT.*", "Other", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("Product_Manager_NA_NA", "Other", 
                          dfs$Job.Type)
dfs$Job.Type <-  gsub("^\\Tech.*", "Other", 
                          dfs$Job.Type)


data.salary <- dfs %>% select("Payment Frequency", "Currency", "Salary", "Job.Type",
                             "Country")

data.salary <- data.salary %>% drop_na()

data.salary <- data.salary %>%
  mutate(Salary = str_replace_all(Salary,c("," = "")))

data.salary$Salary <- as.numeric(data.salary$Salary)

data.salary <- data.salary %>% mutate(Currency = case_when(
  Currency %in% c("NZ $", "NZD") ~ "NZD",
  Currency %in% c("US $", "USD") ~ "USD",
  Currency %in% c("Sterling Pounds", "GBP", "Sterling Pound", "Pounds") ~ "GBP",
  Currency == "AUD" ~ "AUD",
  Currency == "SGD" ~ "SGD",
  Currency %in% c("Euro", "EUR") ~ "EUR",
  Currency == "CZK" ~ "CZK",
  Currency == "Yen" ~ "JPY"
))


data.salary <- data.salary %>% mutate(`Payment Frequency` = case_when(
  `Payment Frequency` == "daily" ~ "daily",
  `Payment Frequency` %in% c("annual", "yearly") ~ "yearly",
  `Payment Frequency` == "hourly" ~ "hourly",
  `Payment Frequency` == "monthly" ~ "monthly"
))

make_common_salary <- function(data_raw){
  
  NZD_ex <- 0.61
  GBP_ex <- 1.27
  AUD_ex <- 0.65
  SGD_ex <- 0.74
  EUR_ex <- 1.1
  CZK_ex <- 0.045
  JPY_ex <- 0.007
  
  
  data_raw %>%
    mutate(Salary.in.USD = case_when(
             Currency == "NZD" ~ Salary * NZD_ex,
             Currency == "GBP" ~ Salary * GBP_ex,
             Currency == "AUD" ~ Salary * AUD_ex,
             Currency == "SGD" ~ Salary * SGD_ex,
             Currency == "EUR" ~ Salary * EUR_ex,
             Currency == "CZK" ~ Salary * CZK_ex,
             Currency == "JPY" ~ Salary * JPY_ex,
             TRUE ~ Salary
           ),
           Salary.in.USD = case_when(
             `Payment Frequency` == "hourly" ~ Salary.in.USD * 40 * 52,
             `Payment Frequency` == "daily" ~ Salary.in.USD * 5 * 52,
             `Payment Frequency` == "monthly" ~ Salary.in.USD *  12,
             `Payment Frequency` == "yearly" ~ Salary.in.USD,
             TRUE ~ Salary,
           ))
}

data.salary <- make_common_salary(data.salary)


```

Row
-------------------------------------

### Distibution of Minimum Salary by Job 

```{r}

df_1 <- subset(data.salary, data.salary$Salary.in.USD < 250000) %>%
        filter(Job.Type %in% c("Data Analyst", "Data Scientist", "Data Engineer", 
                         "Statistician"))

df_1$Job.Type <- factor(df_1$Job.Type, levels = c( "Statistician", "Data Engineer", "Data Scientist", "Data Analyst"))


salary.plot1 <- plot_ly(df_1, x = df_1$Salary.in.USD,
              color = df_1$Job.Type,
              colors = "Dark2",
              type = "box") %>%
  layout(title = "Yearly Salary by Job Type (in USD)",
         xaxis = list(title = "Yearly Salary in USD" ,
                      zeroline = FALSE)) 

hide_legend(salary.plot1)

```

Row
------------------------------------
### Distibution of Minimum Salary by Countries

```{r}
df_1 <- df_1 %>% filter(Country %in% c("United States", "United Kingdom",
                                               "Australia", "Singapore"))
df_1$Country <- factor(df_1$Country, levels = c( "United States", "Australia", "United Kingdom", "Singapore"))

salary.plot2 <- plot_ly(df_1,
                        x = df_1$Salary.in.USD,
                        color = df_1$Country,
                        colors = "Set1",
                        type = "box") %>%
                        layout(title = "Yearly Salary by Country (in USD)",
                        xaxis = list(title = "Yearly Salary in USD" ,
                        zeroline = FALSE))

hide_legend(salary.plot2)

```



Inspiration
======================================================

```{r}

knitr::include_graphics("inspiration_tab_image.png")

```



